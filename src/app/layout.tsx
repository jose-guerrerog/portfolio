import type { Metadata } from "next";
import { Suspense } from "react";
import { ToastContainer } from "react-toastify";
import { ThemeProvider } from "@mui/material";
import { theme } from "./themes/theme";
import { Inter } from "next/font/google";
import "./globals.css";
import "react-toastify/dist/ReactToastify.css";
import CssBaseline from "@mui/material/CssBaseline";
import Navbar from "@/app/components/Navbar";
import dynamic from 'next/dynamic';
import { Box, Typography } from "@mui/material";

import '../lib/draco-setup'; // This runs the setup

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

const StarsBackground = dynamic(() => import('@/app/components/StarsBackground'), { ssr: false });

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <head>
        <link rel="preload" href="/models/death_star-draco-2.glb" as="fetch" crossOrigin="anonymous" />
      </head>
      <body className={inter.className}>
        <StarsBackground />
        <ThemeProvider theme={theme}>
          <CssBaseline />
          <Navbar />
          <ToastContainer />
          <Box
            component="div"
            display="flex"
            justifyContent="center"
            my={14}
            mx={{ xs: 2, sm: 16 }}
          >
            <Box
              component="div"
              width="100%"
              maxWidth={1400}
              display="flex"
              justifyContent={"center"}
            >
              <Suspense
                fallback={<Typography color="#fff">Loading...</Typography>}
              >
                {children}
              </Suspense>
            </Box>
          </Box>
        </ThemeProvider>
      </body>
    </html>
  );
}
